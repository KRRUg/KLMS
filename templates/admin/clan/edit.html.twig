{% extends 'admin/adminBase.html.twig' %}

{% block title %}KLMS - Admin{% endblock %}
{% block siteheading %}<i class="far fa-file-alt"></i> Clan{% endblock %}
{% block main %}
    <h1 class="h3 card-title mb-4">Clan {{ form.vars.value.name }} bearbeiten</h1>
    <div class="clearfix mb-4">
        {{ form_start(form) }}
        {% if not form.vars.valid %}
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle"></i> {{ form_errors(form) }}
            </div>
        {% endif %}

        {% set data = form.vars.data %}

        <div class="row">
            <div class="col-md-4 order-md-2 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        {% include "admin/components/properties.html.twig"
                        with {'fields' : {
                            'uuid' : 'UUID',
                            'createdAt' : "Erstellt",
                        }}
                        %}
                    </div>
                </div>
            </div>
            <div class="col-md-8 order-md-1 mb-4">
                {% embed "site/components/cards/skeletons/cardProfile.html.twig"  with {'cardSymbole': 'fas fas fa-users fa-6x'} %}
                    {% block cardBody %} 
                        {{ form_row(form.name) }}
                        {{ form_row(form.clantag) }}
                        {{ form_row(form.joinPassword) }}
                        {{ form_row(form.website) }}
                        {{ form_row(form.description) }}
                    {% endblock %}
                {% endembed  %}
            </div>
        </div>
        <hr />
        {{ form_rest(form) }}
        <div class="float-right">
            <a class="btn btn-secondary" href="{{ path('admin_clan') }}">Abbrechen</a>
            <button type="submit" id="news_save" class="btn-primary btn">Speichern</button>
        </div>
        {{ form_end(form) }}
        <div class="float-left">
            <form data-toggle="confirmModal" method="post" action="{{ path('admin_clan_delete', {'uuid' : clan.uuid}) }}" class="d-inline-block">
                <input type="hidden" name="_token" value="{{ csrf_token(csrf_token_delete) }}">
                <button class="btn btn-danger" type="submit" value="löschen"><i class="fas fa-trash-alt"></i> Löschen</button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col mb-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="h4 card-title">Clan-Members</h2>
                    <hr />
                    <form method="post" class="form-inline" action="{{ path('admin_clan_member_add', {'uuid' : clan.uuid}) }}">
                        <label for="add_user_uuid">User hinzufügen: </label>
                        <select id="add_user_uuid" style="width:30%;" class="select2-enable form-control" data-remote-target="{{ path('api_users', {'fullUser' : false}) }}" name="user_uuid">
                        </select>
                        <input type="hidden" name="_token" value="{{ csrf_token(csrf_token_member_add) }}">
                        <input class="btn btn-success" type="submit" value="User hinzufügen"/>
                    </form>
                    <hr />
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <td>User</td>
                                <td>Rang</td>
                                <td>Aktionen</td>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in clan.users %}
                                <tr>
                                    <td>
                                        <a data-toggle="ajaxModal" href="{{ path('admin_user_show', {'uuid' : user.uuid}) }}">{{ user.nickname }}</a>
                                    </td>
                                    <td>
                                        {% if user in clan.admins %}
                                            Admin
                                        {% else %}
                                            Mitglied
                                        {% endif %}
                                    </td>
                                    <td>
                                        <form data-toggle="confirmModal" method="post" action="{{ path('admin_clan_member_remove', {'uuid' : clan.uuid}) }}">
                                            <input type="hidden" name="_token" value="{{ csrf_token(csrf_token_member_remove) }}" />
                                            <input type="hidden" name="user_uuid" value="{{ user.uuid }}" />
                                            <input type="submit" value="Entfernen" />
                                        </form>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

