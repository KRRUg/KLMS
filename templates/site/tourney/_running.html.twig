{% from 'site/tourney/show.html.twig' import teamnameA, teamnameB %}
{% from 'site/tourney/_card.html.twig' import tree_button %}

{% macro enter_result_button(game = null, form = null) %}
    {% if game is not null %}
        <button class="btn btn-primary btn-sm" type="button" {% if game.pending %} data-toggle="modal" data-target="#result-modal-{{ game.id }}" {% else %} disabled="disabled"{% endif %}><i class="fa-solid fa-square-poll-horizontal"></i> Ergebnis eintragen</button>
        {% if form is not null %}
            {% include 'site/tourney/_result.modal.html.twig' with { id : 'result-modal-' ~ game.id, form: form, game: game } %}
        {% endif %}
    {% endif %}
{% endmacro %}

{% macro pending_game_box(game = null) %}
    {% if game is not null and game.pending %}
        <div class="box">
            <div class="box-header">
                Ausstehendes Spiel
            </div>
            <div class="box-body text-center">
                {{ teamnameA(game) }} <span class="text-primary font-weight-bold">vs</span> {{ teamnameB(game) }}
            </div>
        </div>
    {% endif %}
{% endmacro %}

{% if not participates %}
    <div class="text-right">
        {{ tree_button(tourney) }}
    </div>
{% else %}
    <div class="text-right">
        {% set f = forms[constant('App\\Controller\\Site\\TourneyController::FORM_NAME_RESULT')] | default(null) %}
        {{ _self.enter_result_button(current_game, f) }}
        {{ tree_button(tourney) }}
    </div>

    <div class="container-fluid row">
        {% if current_game is null %}
            <span>Du bist nicht mehr im Rennen.</span>
        {% else %}
            <div class="col-md-6">
                {{ _self.pending_game_box(current_game) }}
            </div>
        {% endif %}
        <div class="col-md-6">
        {% if not tourney.singlePlayer %}
        {% set team = tm.team %}
            <div class="box">
                <div class="box-header">
                    {{ team.name }}
                </div>
                <div class="box-body">
                    <ul class="list-unstyled">
                    {% for member in team.members %}
                        <li>{{ member.gamer | username }}</li>
                    {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}
        </div>
    </div>
    <hr/>
{% endif %}